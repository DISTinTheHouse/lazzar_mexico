{% extends 'layouts/layout.html' %}
{% block title %}
  Soporte Lazzar
{% endblock %}
{% block content %}

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SP1MJ3P87D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SP1MJ3P87D');
</script>

<style>
  .btn {
        display: inline-block;
        padding: 10px 20px;
        font-size: 16px;
        text-align: center;
        text-decoration: none;
        outline: none;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .btn-warning {
        background-color: #ffc107;
        color: #212529;
    }

    .btn-warning:hover {
        background-color: #ffc107;
        color: #ffffff;
        transform: scale(1.1);
    }
</style>
<h1 class="text-center display-1 fw-bold title" style="background-color: #2586a6; color: #f8f7f6; font-weight: bold; text-shadow: 3px 3px 4px rgba(0, 0, 0, 0.7); padding: 5px;">Mis actividades: </h1>
<h3 class="text-center display-3 title subtitulos" style="color: #a71930; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.5); background: linear-gradient(to bottom, #2586a6, #f2f2f2); padding: 23px;">{{ usuario_log }}</h3>
  <div class="title"  style="display: flex; justify-content: center; align-items: center; padding: 35px; background: linear-gradient(to bottom, #f2f2f2, #f8f7f6);">
    <form id="myForm" method="POST" action="{% url 'crear_ticket' %}">
      {% csrf_token %}
      <button class="btn btn-warning titulos" type="submit" value="Crear Ticket">Crear Nueva Solicitud</button>
    </form>
  </div>

<main class="container-fluid">
  <div>
    <div class="row">
      <div class="col-md-12 col-lg-12 mt-5"> 
        </br>
        <table class="table table-striped table-bordered table-hover mt-4" cellspacing="0" cellpadding="0" id="miTabla"
        style="border:solid 15px #85C1E9; padding: 15px">
            <thead>
                <tr class="table-primary">
                    <th class="text-center titulos" style="font-weight: bolder;">FOLIO</th>
                    <th class="text-center titulos" style="font-weight: bolder;">ASUNTO</th>
                    <th class="text-center titulos" style="font-weight: bolder;">CREACIÓN</th>
                    <th class="text-center titulos" style="font-weight: bolder;">ÚLTIMA ACTIVIDAD</th>
                    <th class="text-center titulos" style="font-weight: bolder;">ESTADO</th>
                    {% if admin %}
                      <th class="text-center" style="font-weight: bolder;">ASIGNADO A:</th>
                    {% endif%}
                </tr>
            </thead>
            <tbody>
              {% for ticket in tickets %}
                {% if ticket.estatus == 'Resuelta' %}
                
                {% else %}
                  <tr>
                      <td class="text-center">{{ ticket.folio }}</td>
                      <td class="text-center ">
                        <a href="{% url 'detalle_ticket' ticket.folio %}">
                          {{ ticket.asunto }}
                        </a>
                      </td>
                      <td class="text-center">{{ ticket.fecha_alta|date:"d/m/y" }}</td>
                      <td class="text-center">
                        {% if ticket.fecha_ultima_respuesta != None %}
                          {{ ticket.fecha_ultima_respuesta|date:"d/m/y" }}
                        {% endif %}
                      </td>
                      <td class="text-center">{{ ticket.estatus }}</td>
                      {% if admin %}
                        <td class="text-center"><a href="{% url 'asignar_ticket' ticket.folio %}">
                          {{ ticket.tecnico }}
                        </a></td>
                      {% endif%}
                {% endif %}
                  </tr>
              {% endfor %}
            </tbody>
        </table>
      </div>
        <script src="https://code.jquery.com/jquery-3.7.0.js"></script>


        <script>
            $(document).ready(function() {
             $('#miTabla').DataTable({

                // Habilitar filtros por columna
                initComplete: function () {
                this.api().columns().every(function () {
                    var column = this;
                    var select = $('<select><option value=""></option></select>')
                    .appendTo($(column.footer()).empty())
                    .on('change', function () {
                        var val = $.fn.dataTable.util.escapeRegex($(this).val());
                        column.search(val ? '^' + val + '$' : '', true, false).draw();
                    });
            
                    column.data().unique().sort().each(function (d, j) {
                    select.append('<option value="' + d + '">' + d + '</option>');
                    });
                });
                }
            });
            });
        </script>
    </div>
</main>

<footer class=" text-center mt-4" style="background-color: #f2f2f2;">
  <div class="row">

    <section style="padding: 23px;" class="titulos">
      © 2023 Copyright:
      <a style="color: #B7950B; text-decoration:underline;" href="https://www.lazzarmexico.com/" class="titulos">Lazzarmexico.com</a>
      
    </section>

  <div class="text-center titulos p-4 larger-text" style="background-color: rgba(11, 34, 101); font-size: 18px; background: linear-gradient(to top, #0B2265, #2586a6);">
      <p style="color: azure;">
          Respeto, Honestidad, Confianza, Responsabilidad, Lealtad
      </p>
  </div>
</footer>
{% endblock %}