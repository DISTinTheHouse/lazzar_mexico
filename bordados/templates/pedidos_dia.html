{% extends 'layouts/layout.html' %}
{% block title %}
    {{title}}
{% endblock %}
{% block content %}

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SP1MJ3P87D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SP1MJ3P87D');
</script>

<h1 class="text-center display-1 fw-bold title" style="background-color: #2586a6; color: #f8f7f6; font-weight: bold; text-shadow: 3px 3px 4px rgba(0, 0, 0, 0.7); padding: 5px;">Bordados</h1>
<p class="display-4 text-left fw-bold text-center title subtitulos" style="color: #fccc0a; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.3); padding: 15px; background: linear-gradient(to bottom, #2586a6, #f8f7f6);"
>Pedidos por día</p>

<main class="container-fluid">

<section class="container-fluid" style="display: flex; justify-content: center; align-items: center; padding:25px">
  <ul class="nav nav-tabs flex-column flex-sm-row mx-auto" id="ex-with-icons" role="tablist">
    <li class="nav-item" role="presentation">
         <a class="nav-link " aria-current="page" href="http://bodegalazzar.ddns.net:3000/envios" style="color: #6c8ead; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.1); font-size: 16px">
           <div class="d-flex flex-column icon-above-text">
             <span class="material-symbols-outlined" style="font-size: 35px">local_shipping</span>
             Rastreo Lazzar
           </div>
         </a>
    </li>
    <li class="nav-item" role="presentation">
      <a class="nav-link" aria-current="page" href="{% url 'pendientes_folios' %}" style="color: #16A085; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.1); font-size: 16px;">
        <div class="d-flex flex-column icon-above-text">
          <span class="material-symbols-rounded" style="font-size: 35px;">hourglass_bottom</span>
          Pendientes
        </div>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" aria-current="page" href="{% url 'entregados_folios' %}" style="color: #3498DB; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.1); font-size: 16px">
        <div class="d-flex flex-column icon-above-text">
          <span class="material-symbols-rounded" style="font-size: 35px;">verified</span>
          Entregados
        </div>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" aria-current="page" href="{% url 'dashboard_Bord' %}" style="color: #F1C40F; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.07); font-size: 16px;">
        <div class="d-flex flex-column icon-above-text">
          <span class="material-symbols-rounded" style="font-size: 35px;">donut_small</span>
          Dashboard
        </div>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" aria-current="page" href="{% url 'buscar_ventas' %}" style="color: #E67E22; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.1); font-size: 16px;">
        <div class="d-flex flex-column icon-above-text">
          <span class="material-symbols-rounded" style="font-size: 35px;">search</span>
          Buscar
        </div>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link active" aria-current="page" href="{% url 'pedidos_dia' %}" style="color: #82E0AA; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.08); font-size: 16px;">
        <div class="d-flex flex-column icon-above-text">
          <span class="material-symbols-rounded" style="font-size: 35px;">today</span>
          Pedidos x día
        </div>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link " aria-current="page" href="{% url 'historial' %}" style="color: #76448A; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.1); font-size: 16px;">
        <div class="d-flex flex-column icon-above-text">
          <span class="material-symbols-rounded" style="font-size: 35px;">deployed_code_history</span>
          Productividad
        </div>
      </a>
    </li>
    <li class="nav-item">
          <a class="nav-link " download="Existencias.xlsx" aria-current="page" href="https://www.lazzarmexico.com/archivos/existencias/Existencias_Lazzar.xlsx" style="color: #00a9db; font-weight: bold; text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.1); font-size: 16px;"> 
            <div class="d-flex flex-column icon-above-text">
              <span class="material-symbols-rounded" style="font-size: 35px;">download</span>
              Existencias
            </div>
          </a>
    </li>
  </ul>
</section>
<!-----------.....ESTILO ICONOS.....----------->
  <style>
     .icon-above-text {
      align-items: center; 
      text-align: center; 
    }
  
    .icon-above-text .material-icons {
      margin-bottom: 1px; 
    }
    .btn{
      display: flex;
      align-items: center;
    }
    .material-icons-round{
      margin-right: 5px;
    }
  </style>
<!-----------.....ESTILO ICONOS.....----------->
<div class="form-outline mb-4 container-sm">
      <input type="text" class="form-control form-control-lg" id="datatable-search-input" placeholder="Buscar Consulta. . ." style="border:solid 8px #D5F5E3; box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3); border-radius: 25px;"/>
      <label class="form-label" for="datatable-search-input"></label>
</div>

<div class="table-responsive" id="datatable">
  <div class="row"> <!--Se reemplazo box -->
      {% if leyenda %}
      </br>
      <table class="table table-striped table-hover table-success table-responsive table-borderedles table-sm" id="miTabla" style="border:solid 10px #7DCEA0;">
          <thead>
              <tr class="table-success" style="background-color: #D5F5E3;">
                  <th class="text-center">PEDIDO</th>
                  <th class="text-center">FECHA</th>
                  <th class="text-center">ORDEN</th>
                  <th class="text-center">PIEZAS</th>
                  <th class="text-center">ENTREGADO</th>
                  <th class="text-center">PROVEEDOR</th>
                  <th class="text-center">FECHA DE SURTIDO</th>
                  <th class="text-center">RECEPCIÓN DE LA ORDEN</th>
                  <th class="text-center">FECHA DE ENTREGA</th>
                  <th class="text-center">SURTIDO</th>
                  <th class="text-center">ESTATUS</th>
                  <th class="text-center">RECIBIÓ</th>
                  <th class="text-center">DESHEBRÓ</th>
                  <th class="text-center">DETALLE</th>
              </tr>
          </thead>
          <tbody>
              {% for fila in resultado %}
                  <tr>
                      <td class="text-center">{{ fila.0 }}</td>
                      <td class="text-center">{{ fila.1 | date:"d/m/y" }}</td>
                      <td class="text-center" style="font-weight: bold;">{{ fila.2 }}</td>
                      <td class="text-center">{{ fila.11|floatformat:0 }}</td>
                      <td class="text-center">{{ fila.12|floatformat:0 }}</td>
                      <td class="text-center" style="font-style: italic;">{{ fila.3 }}</td>
                      <td class="text-center">{{ fila.4|date:"d/m/y" }}</td>

                      {% if fila.5|date:"Y-m-d" == "1900-12-31" %}
                          <td></td>
                      {% else %}
                          <td class="text-center" style="font-weight: bold;">{{ fila.5|date:"d/m/y" }}</td>
                      {% endif %}

                      {% if fila.6|date:"Y-m-d" == "1900-12-31" %}
                          <td></td>
                      {% else %}
                          <td class="text-center">{{ fila.6|date:"d/m/y" }}</td>
                      {% endif %}
                      
                      {% if fila.7 is none %}
                          <td></td>
                      {% else %}
                          <td class="text-center">{{ fila.7 }}</td>
                      {% endif %}

                      {% if fila.8 is none %}
                          <td></td>
                      {% else %}
                          <td class="text-center">{{ fila.8 }}</td>
                      {% endif %}

                      {% if fila.9 is none %}
                          <td></td>
                      {% else %}
                          <td class="text-center">{{ fila.9 }}</td>
                      {% endif %}

                      {% if fila.10 is none %}
                          <td></td>
                      {% else %}
                          <td class="text-center">{{ fila.10 }}</td>
                      {% endif %}
                      <td>
                        <form id="myForm" method="POST" action="{% url 'detalle_bordados' %}">
                          {% csrf_token %}
                          <input type="hidden" name="variable" value="{{ fila.2 }}">
                        <button type="submit" class="btn btn-success" style="border-radius: 25px;">
                          <span class="material-symbols-rounded">data_info_alert</span>
                            Detalle
                        </button>
                        </form>
                      </td>
                  </tr>
              {% endfor %}
          </tbody>
      </table>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/dataTables.semanticui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.9.2/semantic.min.js"></script>
      <script>
         $(document).ready(function() {
      $('#datatable-search-input').on('input', function() {
        var searchText = $(this).val().toLowerCase();
        $('#datatable tbody tr').each(function() {
          var rowText = $(this).text().toLowerCase();
          if (rowText.indexOf(searchText) === -1) {
            $(this).hide();
          } else {
            $(this).show();
          }
        });
      });
    });
    $(document).ready(function() {
             $('#miTabla').DataTable({

                // Habilitar filtros por columna
                initComplete: function () {
                this.api().columns().every(function () {
                    var column = this;
                    var select = $('<select><option value=""></option></select>')
                    .appendTo($(column.footer()).empty())
                    .on('change', function () {
                        var val = $.fn.dataTable.util.escapeRegex($(this).val());
                        column.search(val ? '^' + val + '$' : '', true, false).draw();
                    });
            
                    column.data().unique().sort().each(function (d, j) {
                    select.append('<option value="' + d + '">' + d + '</option>');
                    });
                });
                }
            });
            });
  </script>
      </script>
  </div>
</main>

<footer class=" text-center mt-4 " style="background-color: #f2f2f2;">
  <div class="row">

    <section style="padding: 23px;" class="titulos">
      © 2023 Copyright:
      <a style="color: #B7950B; text-decoration:underline;" href="https://www.lazzarmexico.com/" class="titulos">Lazzarmexico.com</a>
      
    </section>

  <div class="text-center titulos p-4 larger-text" style="background-color: rgba(11, 34, 101); font-size: 18px; background: linear-gradient(to top, #0B2265, #2586a6);">
      <p style="color: azure;">
          Respeto, Honestidad, Confianza, Responsabilidad, Lealtad
      </p>
  </div>
</footer>

<script>
  // Preload
const loader = document.querySelector(".loader");

// Mostrar el preload al hacer clic en un enlace, excluyendo elementos dentro de la barra de navegación
document.addEventListener("click", (event) => {
const target = event.target;

// Verificar si el elemento clickeado es un enlace o parte del menú desplegable
const isLink = target.tagName === "A";
const isDropdownItem = target.classList.contains("dropdown-item");

// Verificar si el elemento clickeado o sus ancestros contienen una clase específica
// que identifique la barra de navegación (en este caso, usaremos "navbar-nav")
const isNavbarItem = target.closest(".navbar-nav");

// Si el elemento clickeado es un enlace, no es parte del menú desplegable,
// y no se encuentra dentro de la barra de navegación, mostrar preload
if (isLink && !isDropdownItem && !isNavbarItem) {
loader.classList.remove("loader-hidden");
}
});

// Ocultar el preload una vez que la página haya cargado completamente
window.addEventListener("load", () => {
loader.classList.add("loader-hidden");
});
</script>
{% endif %}
{% endblock %}